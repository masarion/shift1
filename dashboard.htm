<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚·ãƒ•ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  | ç®¡ç†ãƒ‘ãƒãƒ«</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        :root { 
            --primary: #4361ee; 
            --sidebar-bg: #2b3a67; 
            --active-bg: #4895ef; 
            --bg: #f8f9fc; 
            --text: #2b2d42; 
            --danger: #e11d48;
            --success: #059669;
        }
        body { font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; color: var(--text); }
        
        /* èªè¨¼ç”»é¢ */
        #auth-container { position: fixed; inset: 0; background: rgba(255,255,255,0.9); display: flex; align-items: center; justify-content: center; z-index: 9999; backdrop-filter: blur(5px); }
        .auth-box { width: 380px; padding: 40px; background: white; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; }
        .auth-box input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        
        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        #sidebar { width: 260px; background: var(--sidebar-bg); color: white; padding: 25px 15px; flex-shrink: 0; display: flex; flex-direction: column; }
        #sidebar h3 { font-size: 1.2rem; margin-bottom: 30px; padding-left: 10px; border-left: 4px solid var(--active-bg); }
        .nav-item { padding: 14px 18px; cursor: pointer; border-radius: 10px; margin-bottom: 8px; transition: all 0.3s; display: flex; align-items: center; text-decoration: none; color: white; font-size: 0.95rem; }
        .nav-item:hover { background: rgba(255,255,255,0.1); }
        .nav-active { background: var(--active-bg) !important; font-weight: bold; }
        
        .nav-external { margin-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; overflow-y: auto; }
        .admin-sub-link { font-size: 0.8rem; padding: 8px 12px; margin-bottom: 4px; display: block; color: rgba(255,255,255,0.7); text-decoration: none; border-radius: 6px; }
        .admin-sub-link:hover { background: rgba(255,255,255,0.1); color: white; }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        #main-content { flex-grow: 1; overflow-y: auto; padding: 40px; }
        h1 { font-size: 1.8rem; margin-bottom: 5px; }
        .section-desc { color: #64748b; font-size: 0.9rem; margin-bottom: 25px; }
        
        .card { background: white; padding: 30px; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 25px; border: 1px solid #edf2f7; }
        .card h3 { margin-top: 0; margin-bottom: 15px; font-size: 1.1rem; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .h3-desc { font-size: 0.75rem; font-weight: normal; color: #64748b; }

        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; }
        .field-hint { font-size: 0.75rem; color: #64748b; margin-bottom: 8px; }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; box-sizing: border-box; font-size: 1rem; font-family: inherit; }
        
        /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ */
        .btn-preview-box { background: #eef2ff; padding: 15px; border-radius: 12px; border: 1px solid #c7d2fe; text-align: center; margin-bottom: 20px; }
        .btn-preview { background: var(--primary); color: white; text-decoration: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; display: inline-block; margin-bottom: 8px; }
        .preview-hint { font-size: 0.7rem; color: #ef4444; line-height: 1.4; }

        /* ã‚·ãƒ•ãƒˆæ ã‚¢ã‚¤ãƒ†ãƒ  */
        .shift-item { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; background: #fff; padding: 10px; border: 1px solid #e2e8f0; border-radius: 10px; }
        .drag-handle { cursor: grab; color: #94a3b8; font-size: 1.2rem; display: flex; align-items: center; gap: 8px; }
        .shift-index { font-size: 0.8rem; font-weight: bold; color: var(--primary); }
        
        button { padding: 12px 24px; border-radius: 10px; cursor: pointer; border: none; font-weight: bold; transition: all 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-save-all { background: var(--success); color: white; width: 100%; max-width: 600px; padding: 18px; font-size: 1.1rem; box-shadow: 0 4px 10px rgba(5,150,105,0.3); }
        .btn-secondary { background: #f1f5f9; color: #475569; border: 1px solid #e2e8f0; }
        .btn-danger-light { background: #fff1f2; color: var(--danger); font-size: 0.75rem; padding: 6px 12px; }
        
        #print-area { padding: 20px; border: 2px dashed #cbd5e1; background: white; margin: 20px 0; text-align: center; }
        .ghost { opacity: 0.4; background: #ebf4ff; border: 2px dashed var(--primary); }
    </style>
</head>
<body>

<div id="auth-container">
    <div class="auth-box">
        <h2>ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</h2>
        <input type="email" id="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹">
        <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
        <button class="btn-primary" style="width:100%; margin-top:10px;" onclick="handleAuth()">ãƒ­ã‚°ã‚¤ãƒ³</button>
    </div>
</div>

<div id="sidebar">
    <h3>ã‚·ãƒ•ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h3>
    <div class="nav-item nav-active" id="nav-projects" onclick="showSection('projects')">æ¡ˆä»¶ä¸€è¦§</div>
    <div class="nav-item" id="nav-edit-all" onclick="showSection('edit-all')">å†…å®¹ãƒ»ã‚·ãƒ•ãƒˆæ ç·¨é›†</div>
    <div class="nav-item" id="nav-qr-gen" onclick="showSection('qr-gen'); loadQRProjectList();">URLãƒ»QRã‚³ãƒ¼ãƒ‰</div>
    
    <div class="nav-external">
        <div style="font-size: 0.75rem; color: rgba(255,255,255,0.5); margin-bottom: 10px; padding-left: 10px;">æå‡ºãƒ‡ãƒ¼ã‚¿ç¢ºèª</div>
        <div id="sidebar-admin-links"></div>
    </div>

    <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
        <p id="user-display" style="font-size: 0.75rem; color: rgba(255,255,255,0.6); margin-bottom: 15px;"></p>
        <button onclick="logout()" style="background:transparent; color:rgba(255,255,255,0.4); border:1px solid rgba(255,255,255,0.2); width: 100%; padding: 8px;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>
</div>

<div id="main-content">
    <section id="sec-projects">
        <h1>æ¡ˆä»¶ä¸€è¦§</h1>
        <p class="section-desc">ç¨¼åƒä¸­ã®æ¡ˆä»¶ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã€Œç·¨é›†ã€ãƒœã‚¿ãƒ³ã‹ã‚‰å†…å®¹ã‚’ä¿®æ­£ã§ãã¾ã™ã€‚</p>
        <div class="card" style="text-align: right;"><button class="btn-primary" onclick="createNewProject()">+ æ–°ã—ã„æ¡ˆä»¶ã‚’ä½œæˆ</button></div>
        <div id="project-list-container"></div>
    </section>

    <section id="sec-edit-all" style="display:none;">
        <h1>ãƒšãƒ¼ã‚¸å†…å®¹ã¨ã‚·ãƒ•ãƒˆæ ã®ç·¨é›†</h1>
        <p class="section-desc">ã‚¹ã‚¿ãƒƒãƒ•ç”¨ãƒšãƒ¼ã‚¸ã®å†…å®¹ã‚’ç·¨é›†ã§ãã¾ã™ã€‚ä¸‹éƒ¨ã®ã€Œç·¨é›†ã‚’ä¿å­˜ã—ã¦åæ˜ ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨åæ˜ ã•ã‚Œã¾ã™ã€‚</p>
        
        <div class="btn-preview-box">
            <a id="preview-link" href="#" target="_blank" class="btn-preview">ã‚¹ã‚¿ãƒƒãƒ•ç”¨ãƒšãƒ¼ã‚¸ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ â†—</a>
            <div class="preview-hint">
                â€»ã€Œé€ä¿¡æ¸ˆã¿ã€ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆã¯ã€URLã®æœ«å°¾ã«ã€Œ&1ã€ãªã©ã‚’ä»˜ã‘ã¦èª­ã¿ç›´ã—ã¦ãã ã•ã„ã€‚
            </div>
        </div>

        <div id="current-pj-name" style="margin-bottom:20px; padding: 10px 15px; background: #ebf4ff; border-radius: 8px; color: var(--primary); font-weight: bold; border: 1px solid #bee3f8;"></div>
        
        <div style="display: flex; gap: 30px; align-items: flex-start;">
            <div class="card" style="flex: 1.2;">
                <h3>1. è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆã®è¨­å®š</h3>
                <div class="form-group">
                    <label>ç®¡ç†ç”¨åç§°</label>
                    <div class="field-hint">ã‚¹ã‚¿ãƒƒãƒ•ãŒãƒšãƒ¼ã‚¸ã‚’ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã—ãŸéš›ã®åç§°ã«ãªã‚Šã¾ã™</div>
                    <input type="text" id="field-title_tag">
                </div>
                <div class="form-group">
                    <label>ç”»é¢ãƒˆãƒƒãƒ—ã®è¦‹å‡ºã—</label>
                    <textarea id="field-h1_title" rows="2"></textarea>
                </div>
                <div class="form-group"><label>å†’é ­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label><textarea id="field-msg_top" rows="3"></textarea></div>
                <div class="form-group"><label>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ“ä½œèª¬æ˜</label><textarea id="field-msg_calendar" rows="3"></textarea></div>
                <div class="form-group"><label>ãƒ•ã‚©ãƒ¼ãƒ èª¬æ˜</label><textarea id="field-msg_bottom" rows="3"></textarea></div>
                <div class="form-group"><label>ç¢ºèªç”»é¢ã®æ³¨æ„æ›¸ã</label><textarea id="field-msg_confirm" rows="3"></textarea></div>
            </div>

            <div class="card" style="flex: 0.8;">
                <h3>
                    2. ã‚·ãƒ•ãƒˆæ ã®ç¨®é¡
                    <span class="h3-desc">ä¸¦ã¹æ›¿ãˆã¯ â˜° ã‚’ãƒ‰ãƒ©ãƒƒã‚°</span>
                </h3>
                <div class="field-hint">ã€Œï¼‹æ ã‚’è¿½åŠ ã€ã§è¿½åŠ ã€ã‚´ãƒŸç®±ãƒœã‚¿ãƒ³ã§å‰Šé™¤ã§ãã¾ã™ã€‚</div>
                <div id="shift-list"></div>
                <button class="btn-secondary" style="width: 100%; margin-top: 15px;" onclick="addShiftRow()">+ æ ã‚’è¿½åŠ </button>
            </div>
        </div>

        <div style="text-align: center; margin-top: 40px; padding-bottom: 60px;">
            <button class="btn-save-all" onclick="saveAllSettings()">ç·¨é›†ã‚’ä¿å­˜ã—ã¦åæ˜ ã™ã‚‹</button><br>
            <button class="btn-delete-project" onclick="deleteCurrentProject()" style="margin-top:30px; background:none; border:none; color:#94a3b8; cursor:pointer; text-decoration:underline; font-size:0.8rem;">ã“ã®æ¡ˆä»¶è‡ªä½“ã‚’å®Œå…¨ã«å‰Šé™¤ã™ã‚‹</button>
        </div>
    </section>

    <section id="sec-qr-gen" style="display:none;">
        <h1>å…±æœ‰ç”¨URLãƒ»QRã‚³ãƒ¼ãƒ‰ä½œæˆ</h1>
        <p class="section-desc">æ¡ˆä»¶ã”ã¨ã«ã‚¹ã‚¿ãƒƒãƒ•é…å¸ƒç”¨ã®URLã¨QRã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªãƒ»å°åˆ·ã§ãã¾ã™ã€‚</p>
        <div style="display: flex; gap: 30px;">
            <div class="card" style="flex: 1;">
                <h3>æ¡ˆä»¶ã‚’é¸æŠ</h3>
                <div id="qr-project-list" style="max-height: 500px; overflow-y: auto;"></div>
            </div>
            <div class="card" style="flex: 1.5; text-align: center;">
                <h3>å°åˆ·ç”¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
                <div id="print-area">
                    <h2 id="qr-display-name" style="font-size: 1.3rem; margin-bottom: 15px;">æ¡ˆä»¶ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
                    <div id="qrcode" style="display: flex; justify-content: center; margin-bottom: 15px;"></div>
                    <p id="qr-display-url" style="font-size: 0.75rem; color: #64748b; word-break: break-all;"></p>
                </div>
                <button class="btn-primary" id="btn-print" onclick="printQRCode()" style="display:none; width: 100%;">ğŸ–¨ï¸ æ²ç¤ºç”¨ã‚·ãƒ¼ãƒˆã‚’å°åˆ·ã™ã‚‹</button>
            </div>
        </div>
    </section>
</div>

<script>
    const S_URL = 'https://vryxvtzrvmtyryugqzlp.supabase.co';
    const S_KEY = 'sb_publishable_RnuLQC0N_wYOrwLFQIf5Gg_O-g_bc2m';
    const client = supabase.createClient(S_URL, S_KEY);
    let currentProjectId = null;
    let sortableInstance = null;

    async function handleAuth() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const { error } = await client.auth.signInWithPassword({ email, password });
        if (error) alert("ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—: " + error.message);
        else location.reload();
    }
    async function logout() { await client.auth.signOut(); window.location.replace('dashboard.htm'); }

    function showSection(id) {
        document.querySelectorAll('section').forEach(s => s.style.display = 'none');
        document.getElementById('sec-' + id).style.display = 'block';
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('nav-active'));
        document.getElementById('nav-' + id).classList.add('nav-active');
    }

    async function loadProjectData() {
        const { data: projects } = await client.from('projects').select('*').order('created_at', { ascending: false });
        if(!projects) return;
        document.getElementById('sidebar-admin-links').innerHTML = projects.map(pj => `<a href="admin.htm?id=${pj.id}" target="_blank" class="admin-sub-link">ğŸ“Š ${pj.title_tag}</a>`).join('');
        document.getElementById('project-list-container').innerHTML = projects.map(pj => `
            <div class="card" style="display:flex; justify-content:space-between; align-items:center; padding: 20px 30px;">
                <div><strong>${pj.title_tag}</strong></div>
                <button class="btn-primary" onclick="selectProject('${pj.id}')">ç·¨é›†</button>
            </div>
        `).join('');
    }

    async function selectProject(id) {
        currentProjectId = id;
        const { data: pj } = await client.from('projects').select('*').eq('id', id).single();
        if (!pj) return;
        document.getElementById('current-pj-name').textContent = `ç¾åœ¨é¸æŠä¸­: ${pj.title_tag}`;
        document.getElementById('field-title_tag').value = pj.title_tag || '';
        document.getElementById('field-h1_title').value = pj.h1_title || '';
        document.getElementById('field-msg_top').value = pj.msg_top || '';
        document.getElementById('field-msg_calendar').value = pj.msg_calendar || '';
        document.getElementById('field-msg_bottom').value = pj.msg_bottom || '';
        document.getElementById('field-msg_confirm').value = pj.msg_confirm || '';
        const baseUrl = window.location.href.split('dashboard.htm')[0];
        document.getElementById('preview-link').href = baseUrl + 'index.htm?id=' + id + '&preview=true';
        const { data: shifts } = await client.from('shift_types').select('*').eq('project_id', id).order('display_order');
        const list = document.getElementById('shift-list');
        list.innerHTML = '';
        if(shifts && shifts.length > 0) shifts.forEach(s => addShiftRow(s.name));
        else addShiftRow('ä¼‘ã¿');
        if (sortableInstance) sortableInstance.destroy();
        sortableInstance = new Sortable(list, { handle: '.drag-handle', animation: 150, onEnd: updateShiftNumbers });
        updateShiftNumbers();
        showSection('edit-all');
    }

    function addShiftRow(name = '') {
        const div = document.createElement('div');
        div.className = 'shift-item';
        div.innerHTML = `<div class="drag-handle">â˜° <span class="shift-index"></span></div><input type="text" class="shift-name-input" value="${name}"><button class="btn-danger-light" onclick="removeShiftRow(this)">å‰Šé™¤</button>`;
        document.getElementById('shift-list').appendChild(div);
        updateShiftNumbers();
    }

    function removeShiftRow(btn) {
        if (confirm("ã“ã®æ ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\n(ã€Œç·¨é›†ã‚’ä¿å­˜ã€ã‚’æŠ¼ã™ã¾ã§ç¢ºå®šã¯ã•ã‚Œã¾ã›ã‚“)")) {
            btn.parentElement.remove();
            updateShiftNumbers();
        }
    }

    function updateShiftNumbers() {
        document.querySelectorAll('.shift-index').forEach((span, i) => { span.textContent = i + 1; });
    }

    async function saveAllSettings() {
        if (!currentProjectId) return;
        await client.from('projects').update({
            title_tag: document.getElementById('field-title_tag').value,
            h1_title: document.getElementById('field-h1_title').value,
            msg_top: document.getElementById('field-msg_top').value,
            msg_calendar: document.getElementById('field-msg_calendar').value,
            msg_bottom: document.getElementById('field-msg_bottom').value,
            msg_confirm: document.getElementById('field-msg_confirm').value
        }).eq('id', currentProjectId);
        await client.from('shift_types').delete().eq('project_id', currentProjectId);
        const newShifts = Array.from(document.querySelectorAll('.shift-item')).map((row, i) => ({
            project_id: currentProjectId, name: row.querySelector('.shift-name-input').value, display_order: i
        })).filter(s => s.name.trim() !== '');
        if(newShifts.length > 0) await client.from('shift_types').insert(newShifts);
        alert("è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚ã‚¹ã‚¿ãƒƒãƒ•ç”¨ãƒšãƒ¼ã‚¸ã«åæ˜ ã•ã‚Œã¦ã„ã¾ã™ã€‚");
        loadProjectData();
    }

    async function loadQRProjectList() {
        const { data: projects } = await client.from('projects').select('*').order('created_at', { ascending: false });
        document.getElementById('qr-project-list').innerHTML = projects.map(pj => `
            <div onclick="prepareQR('${pj.id}', '${pj.title_tag}')" style="padding:15px; border:1px solid #eee; border-radius:10px; margin-bottom:10px; cursor:pointer; background:#fff;">
                <strong>${pj.title_tag}</strong>
            </div>
        `).join('');
    }

    function prepareQR(id, title) {
        const baseUrl = window.location.href.split('dashboard.htm')[0];
        const targetUrl = baseUrl + 'index.htm?id=' + id;
        document.getElementById('qr-display-name').textContent = title;
        document.getElementById('qr-display-url').textContent = targetUrl;
        document.getElementById('qrcode').innerHTML = "";
        new QRCode(document.getElementById("qrcode"), { text: targetUrl, width: 160, height: 160, correctLevel: QRCode.Level.H });
        document.getElementById('btn-print').style.display = 'block';
    }

    function printQRCode() {
        const title = document.getElementById('qr-display-name').textContent;
        const qrSvg = document.getElementById('qrcode').innerHTML;
        const url = document.getElementById('qr-display-url').textContent;
        const win = window.open('', '_blank');
        win.document.write(`
            <html><head><title>Print</title><style>
                body { font-family: sans-serif; text-align: center; padding: 20px; margin:0; }
                .sheet { border: 1px solid #000; height: 95vh; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; }
                h1 { font-size: 2.8rem; margin: 30px 0; line-height: 1.2; }
                .qr-box { transform: scale(2.0); margin: 80px 0; }
                .footer { font-size: 1.2rem; font-weight: bold; margin-top: auto; border-top: 1px solid #eee; padding-top: 20px; width: 80%; }
            </style></head><body>
            <div class="sheet">
                <div style="font-size: 1.2rem;">ã‚·ãƒ•ãƒˆå¸Œæœ›æå‡ºç”¨ QRã‚³ãƒ¼ãƒ‰</div>
                <h1>${title}</h1>
                <div class="qr-box">${qrSvg}</div>
                <div style="color:#666; font-size: 0.8rem; margin-bottom:40px;">URL: ${url}</div>
                <div class="footer">ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®ã‚«ãƒ¡ãƒ©ã§èª­ã¿å–ã£ã¦ãã ã•ã„</div>
            </div>
            <script>window.onload = () => { window.print(); window.close(); };<\/script>
            </body></html>
        `);
        win.document.close();
    }

    async function deleteCurrentProject() {
        if (!currentProjectId) return;
        if (confirm("ã€é‡è¦ã€‘ã“ã®æ¡ˆä»¶ã¨ã€ã“ã‚Œã¾ã§ã«é›†ã¾ã£ãŸã™ã¹ã¦ã®æå‡ºãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚")) {
            await client.from('submissions').delete().eq('project_id', currentProjectId);
            await client.from('shift_types').delete().eq('project_id', currentProjectId);
            await client.from('projects').delete().eq('id', currentProjectId);
            alert("æ¡ˆä»¶ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚");
            location.reload();
        }
    }

    async function createNewProject() {
        const name = prompt("æ–°ã—ã„æ¡ˆä»¶åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        if (!name) return;
        const { data } = await client.from('projects').insert([{ title_tag: name, h1_title: 'ã‚·ãƒ•ãƒˆå¸Œæœ›æå‡ºãƒ•ã‚©ãƒ¼ãƒ ' }]).select();
        loadProjectData();
    }

    window.onload = async () => {
        const { data: { session } } = await client.auth.getSession();
        if (session) {
            document.getElementById('auth-container').style.display = 'none';
            document.getElementById('user-display').textContent = `ç®¡ç†è€…: ${session.user.email}`;
            loadProjectData();
        }
    };
</script>
</body>
</html>
